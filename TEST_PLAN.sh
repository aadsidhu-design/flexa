#!/bin/bash

# Comprehensive Fixes Test Plan
# Run this script to verify all fixes are working correctly

echo "üéÆ FLEXA GAME FIXES - TEST PLAN"
echo "================================"
echo ""

echo "üìã PRE-TEST SETUP:"
echo "1. ‚úÖ Ensure iPhone simulator is running (iPhone 15 Pro recommended)"
echo "2. ‚úÖ Build completed successfully"
echo "3. ‚úÖ Launch app on simulator"
echo "4. ‚úÖ Complete calibration if needed"
echo ""

echo "üéØ CAMERA GAMES TESTING (Phone Must Be Vertical):"
echo ""

echo "TEST 1: Balloon Pop (Elbow Extension)"
echo "--------------------------------------"
echo "‚úì Hold phone vertically in simulator"
echo "‚úì Check: Single cyan pin visible (not two)"
echo "‚úì Move arm UP ‚Üí pin should move UP (not down)"
echo "‚úì Move arm DOWN ‚Üí pin should move DOWN (not up)"
echo "‚úì Pin should stick precisely to wrist"
echo "‚úì Fully extend elbow to pop balloons"
echo "‚úì Verify reps register correctly"
echo ""

echo "TEST 2: Arm Raises (Constellation Maker)"
echo "-----------------------------------------"
echo "‚úì Prop phone vertically (use stand in real test)"
echo "‚úì Check: Cyan circle appears ONLY when wrist detected"
echo "‚úì Circle should stick instantly to wrist position"
echo "‚úì Move hand to target dot"
echo "‚úì Check: Cyan line appears ONLY when near target"
echo "‚úì Line connects target dot to hand position"
echo "‚úì Complete pattern by touching dots in order"
echo "‚úì Verify: NO TIMER displayed"
echo "‚úì Verify: Shows 'Pattern X/3' and 'No timer - take your time!'"
echo ""

echo "TEST 3: Wall Climbers"
echo "---------------------"
echo "‚úì Prop phone to see full body"
echo "‚úì Raise both arms above head"
echo "‚úì Check: Altitude increases"
echo "‚úì Lower arms to sides"
echo "‚úì Check: Altitude decreases"
echo "‚úì Verify: NO TIMER displayed"
echo "‚úì Verify: Hand circles track wrists accurately"
echo "‚úì Game ends at 1000m altitude"
echo ""

echo "üéÆ HANDHELD GAMES TESTING:"
echo ""

echo "TEST 4: Follow Circle (Pendulum Circles)"
echo "-----------------------------------------"
echo "‚úì Hold phone in hand normally"
echo "‚úì Move arm in CLOCKWISE circle"
echo "‚úì Check: Green cursor moves CLOCKWISE (not counter-clockwise)"
echo "‚úì Move arm in COUNTER-CLOCKWISE circle"  
echo "‚úì Check: Green cursor moves COUNTER-CLOCKWISE"
echo "‚úì Keep cursor inside white guide circle"
echo "‚úì Complete a full circle (350¬∞+)"
echo "‚úì Verify: Rep counter increases by 1 (not 8-9)"
echo "‚úì Verify: Smoothness calculated and displayed in results"
echo "‚úì Check: 5-second grace period at start"
echo ""

echo "TEST 5: Fan The Flame"
echo "---------------------"
echo "‚úì Hold phone in hand"
echo "‚úì Make SMALL left-right swings"
echo "‚úì Check: Each swing reduces flame"
echo "‚úì Make LARGE left-right swings"
echo "‚úì Check: Each swing reduces flame"
echo "‚úì Verify: Both small and large swings count as reps"
echo "‚úì Verify: Flame intensity decreases with each swing"
echo "‚úì Continue until flame is extinguished"
echo "‚úì Verify: Smoothness score in results"
echo ""

echo "TEST 6: Fruit Slicer (Reference)"
echo "---------------------------------"
echo "‚úì Hold phone and swing across body"
echo "‚úì Slice fruits, avoid bombs"
echo "‚úì Verify: Smoothness calculated (reference implementation)"
echo "‚úì Verify: SPARC score displayed in results"
echo ""

echo "‚öôÔ∏è UI/UX TESTING:"
echo ""

echo "TEST 7: Scroll Indicators"
echo "-------------------------"
echo "‚úì Navigate to any scrollable view (Settings, History, etc.)"
echo "‚úì Scroll up and down"
echo "‚úì Verify: NO grey scroll indicator visible on right side"
echo ""

echo "TEST 8: Instructions"
echo "--------------------"
echo "‚úì Go to each game's instructions page"
echo "‚úì Verify: Instructions are clear and specific"
echo "‚úì Check: Phone orientation emphasized (VERTICAL for camera games)"
echo "‚úì Check: Movement descriptions are detailed"
echo "‚úì Verify: Goal/objective is clear"
echo ""

echo "TEST 9: Data Export"
echo "-------------------"
echo "‚úì Navigate to Settings ‚Üí Data Management"
echo "‚úì Tap 'Download Data'"
echo "‚úì Verify: Confirmation dialog appears"
echo "‚úì Confirm download"
echo "‚úì Verify: Export success message with session count and file size"
echo "‚úì Verify: Share sheet opens"
echo "‚úì Save to Files or share via AirDrop"
echo "‚úì Open exported JSON file"
echo "‚úì Verify: Contains sessions, ROM, SPARC, progress data"
echo ""

echo "TEST 10: Skip Survey"
echo "--------------------"
echo "‚úì Complete any exercise"
echo "‚úì On post-survey screen, tap 'Skip Survey'"
echo "‚úì Verify: Returns to home"
echo "‚úì Check: Daily goals updated (session count increased)"
echo "‚úì Verify: Progress circles reflect new data"
echo ""

echo "üìä DATA VALIDATION:"
echo ""

echo "TEST 11: Smoothness/SPARC Graphs"
echo "---------------------------------"
echo "‚úì Complete various exercises"
echo "‚úì View session details/graphs"
echo "‚úì Verify: Smoothness graph displays for all games"
echo "‚úì Verify: SPARC scores are non-zero and reasonable (0-100)"
echo "‚úì Check: ROM graph shows movement range"
echo ""

echo "TEST 12: Rep Detection Accuracy"
echo "--------------------------------"
echo "‚úì For circular motions: Do 3 complete circles"
echo "‚úì Verify: Rep count is 3 (not 14 or other high number)"
echo "‚úì For swings: Do 5 swings left-right"
echo "‚úì Verify: Rep count is close to 5 (¬±1 acceptable)"
echo "‚úì For arm raises: Touch 5 targets"
echo "‚úì Verify: Score reflects 5 targets hit"
echo ""

echo "üîç COORDINATE DEBUGGING:"
echo ""

echo "If coordinates seem wrong:"
echo "1. Check console logs for '[COORDS]' tags"
echo "2. Look for Vision RAW coordinates (0-640, 0-480)"
echo "3. Look for MAPPED Screen coordinates (0-390, 0-844)"
echo "4. Verify mapping looks correct:"
echo "   - Small Vision Y ‚Üí Small Screen X (left side)"
echo "   - Large Vision Y ‚Üí Large Screen X (right side)"
echo "   - Small Vision X ‚Üí Small Screen Y (top)"
echo "   - Large Vision X ‚Üí Large Screen Y (bottom)"
echo ""

echo "üêõ KNOWN ISSUES TO MONITOR:"
echo ""
echo "1. Circle rep detection may still overcount occasionally"
echo "   ‚Üí Log circle angle traveled and radius"
echo "   ‚Üí Check thresholds (350¬∞, 80px, 8s)"
echo ""
echo "2. Small swings in Fan The Flame may miss occasionally"
echo "   ‚Üí Check Universal3D rep detection threshold"
echo "   ‚Üí Monitor swing ROM values"
echo ""
echo "3. Skip survey goal updates"
echo "   ‚Üí Verify goals service called"
echo "   ‚Üí Check daily progress persistence"
echo ""

echo "‚úÖ SUCCESS CRITERIA:"
echo ""
echo "All tests pass if:"
echo "‚Ä¢ Camera games: Correct vertical tracking (up=up, down=down)"
echo "‚Ä¢ Circular motion: Matches user's direction (clockwise=clockwise)"
echo "‚Ä¢ Rep counting: Accurate (within ¬±1 for circular, exact for targets)"
echo "‚Ä¢ UI: No scroll indicators visible"
echo "‚Ä¢ Instructions: Clear and helpful"
echo "‚Ä¢ Data export: Works and contains all data"
echo "‚Ä¢ Smoothness: Calculated and graphed for all games"
echo ""

echo "üöÄ READY TO TEST!"
echo ""
echo "Run the app and go through each test systematically."
echo "Log any failures and note the specific behavior observed."
echo ""
